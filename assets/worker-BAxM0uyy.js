(function(){"use strict";async function g(s,o){const{type:c}=s,n=await createImageBitmap(s);let{width:e,height:t}=n,{quality:l=.8,lenSizeLimit:r=8192,fileSizeLimit:u=30,useWebp:w=!0}=o||{};const x=w?"image/webp":c,m=u<<20,f=e*t,M=Math.min(r,32767);let a=1;(f>268435456||e>r||t>r)&&(a=Math.min(Math.sqrt(268435456/f),M/e,M/t),e=Math.floor(e*a),t=Math.floor(t*a));const h=new OffscreenCanvas(e,t),p=h.getContext("2d");p.scale(a,a),p.drawImage(n,0,0);let i;do i=await h.convertToBlob({type:x,quality:l}),l*=m/i.size-.1;while(i.size>m&&l>.1);return i}self.onmessage=s=>{const[o,c]=s.data;g(o,c).then(n=>{self.postMessage(n)})}})();
